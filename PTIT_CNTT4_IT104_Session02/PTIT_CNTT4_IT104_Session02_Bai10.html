<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script>
        function calculateInvoice(products, bulkDiscount = 0) {
            let totalBeforeDiscount = 0;
            let totalAfterDiscount = 0;
            const details = [];
            products.forEach(product => {
                const { name, price, quantity, discount } = product;
                const before = price * quantity;
                totalBeforeDiscount += before;
                const finalPrice = Math.round(price * (1 - discount) * (1 - bulkDiscount));
                const subtotal = finalPrice * quantity;
                totalAfterDiscount += subtotal;
                details.push({ name, finalPrice, quantity, subtotal });
            });
            return {totalBeforeDiscount,totalAfterDiscount,details};
        };
        const products = [
            { name: "A", price: 100, quantity: 2, discount: 0.1 },
            { name: "B", price: 200, quantity: 1, discount: 0.2 },
            { name: "C", price: 300, quantity: 3, discount: 0.15 }
        ];
        console.log(calculateInvoice(products,0.05));
    </script>
</body>

</html>